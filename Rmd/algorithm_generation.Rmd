---
title: "Algorithm"
author: "Anandu R"
date: "5/31/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Importing necessary packages/Libraries 

```{r}
invisible(library(dplyr))
invisible(library(lubridate))
invisible(library(caTools))
invisible(library(data.table))
invisible(library(rpart))
invisible(library(rpart.plot))
invisible(library(C50))
```


## Generating the dataset 

```{r}
set.seed(1)
speed = round(rnorm(1000,50,15),2)
dist_prev = abs(round(rnorm(1000,2,1),2))
dist_next = abs(round(rnorm(1000,2,1),2))
crowd_curr = rpois(1000,25)
crowd_next = rpois(1000,25)
booked = rpois(1000,40)
schd_time = sample(seq(strptime('01/01/2018',format = "%d/%m/%Y"),
                       strptime('01/01/2019',format = "%d/%m/%Y"),
                       by="hour"), 1000, replace = T)
arr_time = schd_time+(rnorm(1000,300,350)*-1)
on_time = ifelse(difftime(arr_time,schd_time)<=0,1,0)
data = data.frame(crowd_curr,crowd_next,booked,
                  dist_prev, dist_next,speed,
                  schd_time,arr_time,on_time)
head(select(data,crowd_curr,crowd_next,booked,on_time))
```


## Generating an algorithm to label the datasets 

Each record is considered as a bus and the label is the indication given to the bus driver whether to maintain speed, decrease speed, or to increase represented by 0,1,2 respectively 

```{r}
indicate = ifelse((
    (crowd_curr<28)&
    (crowd_next>28)&
    (booked>30)&
    (on_time==0)),2,ifelse((
      (crowd_curr>28)&
      (crowd_next<28)&
      (booked<30)&
      (on_time==1)),1,0))
data$indicate = indicate
head(select(data,crowd_curr,booked,on_time,indicate))
```

The table below indicates the indications that each of the bus instances receive 

```{r}
table(data$indicate)
```


## Modelling a decision tree algorithm to make future scheduling 

Splitting the data into train and test 

```{r}
set.seed(1)
split = sample.split(data$indicate, SplitRatio = 0.75)
train = data[split,]
test = data[!split,]
```


Creating a penalty matrix to avoid miscalculation 

```{r}
penalty.matrix <- matrix(c(1,1,0,10,0,10,0,0,0), byrow=TRUE, nrow=3)
```

Building the decision tree model with rpart 

```{r}
dtree <- rpart(indicate~.,data=data,method = "class")
```

Visualizing the decision tree 

```{r}
rpart.plot(dtree, nn=TRUE)
```

Using C50 algorithm to model 

```{r}
dtree = C5.0(train[,-c(4:8,10)],as.factor(train[,10]))
summary(dtree)
```

Visualize outcome 

```{r}
plot(dtree, main = 'Bus Scheduling tree')
```

